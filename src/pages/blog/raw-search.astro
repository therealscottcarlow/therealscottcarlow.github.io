---
// Get all URL parameters directly from the raw request
const rawUrl = Astro.request.url;
const requestUrl = new URL(rawUrl);
const rawQuery = requestUrl.searchParams.get('q') || '';

// Get parameters from Astro's URL object
const astroQuery = Astro.url.searchParams.get('q') || '';

// Try a different approach with new URLSearchParams
const urlSearchString = Astro.request.url.split('?')[1] || '';
const urlParams = new URLSearchParams(urlSearchString);
const altQuery = urlParams.get('q') || '';

// Display all request properties for debugging
const requestInfo = {
  method: Astro.request.method,
  astroUrl: Astro.url.toString(),
  rawUrl: Astro.request.url,
  queryString: requestUrl.search,
  rawQuery,
  astroQuery,
  altQuery,
  headers: Object.fromEntries(Astro.request.headers),
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raw URL Parameter Test</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    form { margin: 20px 0; }
    input { padding: 8px; font-size: 16px; width: 300px; }
    button { padding: 8px 16px; background: #4d5eff; color: white; border: none; }
    .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Raw URL Parameter Test</h1>
  
  <section class="section">
    <h2>Test Search Form</h2>
    <form action="/blog/raw-search" method="get">
      <input type="text" name="q" placeholder="Enter search term" value={rawQuery}>
      <button type="submit">Search</button>
    </form>
  </section>
  
  <section class="section">
    <h2>Request Information</h2>
    <pre>{JSON.stringify(requestInfo, null, 2)}</pre>
  </section>
  
  <section class="section">
    <h2>Direct JavaScript Check</h2>
    <div id="js-output">Loading...</div>
    
    <script>
      // Display query parameter from client-side
      const jsOutput = document.getElementById('js-output');
      const urlParams = new URLSearchParams(window.location.search);
      const jsQuery = urlParams.get('q');
      
      jsOutput.innerHTML = `
        <p><strong>window.location.href:</strong> ${window.location.href}</p>
        <p><strong>window.location.search:</strong> ${window.location.search}</p>
        <p><strong>Query from JS:</strong> ${jsQuery ? `"${jsQuery}"` : '<em>not set</em>'}</p>
        <p><strong>All search params:</strong> ${JSON.stringify(Object.fromEntries(urlParams))}</p>
      `;
    </script>
  </section>
  
  <p><a href="/blog">Back to Blog</a></p>
</body>
</html>